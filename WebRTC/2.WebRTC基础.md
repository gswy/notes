# 信令与视频通话

WebRTC允许在两个设备之间进行实时的对等媒体交换。通过称为**信令**的发现和协商过程建立连接。本教程将指导进行构建双向视频通话。

WebRTC是一个完全对等技术，用于实时交换音频、视频等数据，同时提供一个中心警告。如其他地方所讨论的，必须进行一种发现和媒体格式协商，使不同网络上的两个设备进行定位。这过程被称为**信令**，并涉及两个设备连接到第三个共同协商的服务器。通过这个服务器，两台设备可以互相定位并交换协商消息。

# 信令服务器

两个设备之间建立WebRTC连接，需要一个**信令服务器**来实现双方通过网络进行连接。信令服务器作为一个中间人帮助双方在尽可能的少的暴露隐私的情况下建立连接。WebRTC并没有提供信令传递机制，所以使用自己喜欢的方式进行交换彼此令牌信息。例如可以使用WebSocket或者XMLHttpRequest等等来交换彼此信息。

> 信令服务器不需要理解和解释信令数据内容。虽然它基于SDP但是这并不重要：通过信令服务器的消息内容实际上是一个黑盒。

## 设计信令协议

我们要构建一套信息交换规则，实现方式有多种，这只是其中之一。

### 交换会话描述信息

开始处理信号的时候，用户的初始化操作会创建一个**请求（offer）**，根据SDP协议其中会包含一个session描述符，并且需要把这个发送到我们称之为**接收者（callee）**那里，接受者需要返回一个包含描述符的**应答（answer）**信息。

我们服务器使用WebSocket来传递“video-offer”和“video-answer”两种类型的消息数据。这些属性包含以下几种：

- **type**：消息类型，“video-offer”或者“video-answer”。
- **name**：发送者用户名
- **target**：接受者的用户名（如果呼叫者正在发送消息，则指定被呼叫者，反之亦然）
- **sdp**：描述连接本地端SDP（Session Description Protocol）协议字符串（从接收者的角度来看，它描述远程端）

## 交换ICE候选

两个端需要交换ICE候选来协商他们自己具体如何连接。每一个ICE候选描述一个发送者使用的通信方法，每个节点按照他们被发现的顺序发送候选并且保持发送直到退出，即使媒体数据流已经开始传递也要如此。
